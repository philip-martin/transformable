!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Transformable=e():t.Transformable=e()}(this,function(){return function(){"use strict";var t={d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,e||"default");if("object"!=n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}t.d(e,{default:function(){return L}});var o=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n}return e=t,n=[{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"round",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=e?Math.pow(10,e):1;return new t(Math.round(this.x*n)/n,Math.round(this.y*n)/n)}},{key:"sub",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"mult",value:function(e){return new t(this.x*e.x,this.y*e.y)}},{key:"divide",value:function(e){return new t(this.x/e.x,this.y/e.y)}},{key:"nonzero",value:function(){return 0!==this.x||0!==this.y}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"moreoreq",value:function(t){return{x:this.x>=t.x,y:this.y>=t.y}}},{key:"lessoreq",value:function(t){return{x:this.x<=t.x,y:this.y<=t.y}}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"perpOnLine",value:function(e,n){var r=((n.y-e.y)*(this.x-e.x)-(n.x-e.x)*(this.y-e.y))/(Math.pow(n.y-e.y,2)+Math.pow(n.x-e.x,2));return new t(this.x-r*(n.y-e.y),this.y+r*(n.x-e.x))}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}],n&&r(e.prototype,n),a&&r(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,a}(),i=o,s=function(t){if(null==t||void 0===t)return s.Identity();if(t instanceof Array)this.elements=t.slice(0);else if(t instanceof s)this.elements=t.elements.slice(0);else{if(6!=arguments.length)throw new Error("Can't create Matrix from supplied arguments. Array of 6 elements, Matrix or nothing only.");this.elements=[];for(var e=0;e<arguments.length;)this.elements.push(arguments[e++])}return this.history={undo:[],redo:[]},this};s.Identity=function(){return new s([1,0,0,1,0,0])},s.prototype={transformpoint:function(t){var e=this.elements;return new i(t.x*e[0]+t.y*e[2]+e[4],t.x*e[1]+t.y*e[3]+e[5])},multiply:function(t){var e=this.elements,n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=t[0],c=t[1],u=t[2],h=t[3],f=t[4],m=t[5];return this.elements=[n*l+a*c,r*l+o*c,n*u+a*h,r*u+o*h,n*f+a*m+i,r*f+o*m+s],this},elementsequal:function(t,e){return!(!t||!e)&&(t[0]==e[0]&&t[1]==e[1]&&t[2]==e[2]&&t[3]==e[3]&&t[4]==e[4]&&t[5]==e[5])},save:function(t){var e,n=this.history,r="string"==typeof t&&t;if(t&&!r||(t=this.elements),e=n.undo[n.undo.length-1],this.elementsequal(t,e))r&&(n.undo[r]=e);else{var a=n.undo.push(t.slice(0));n.redo=[],r&&(n.undo[r]=n.undo[a-1])}},undo:function(t){var e=this.history.undo,n=(e.length,e.pop()),r="string"==typeof t?e[t]:e[e.length-1];n&&this.history.redo.unshift(n),this.elements=r?r.slice(0):this.identity()},redo:function(){var t=this.history.redo,e=(t.length,t.pop()),n=t[t.length-1];e&&this.history.undo.unshift(e),this.elements=n?n.slice(0):this.identity()},reset:function(){return this.elements=this.identity(),this},determinant:function(){var t=this.elements;return t[0]*t[3]-t[1]*t[2]},inverse:function(){var t=this.elements,e=this.identity(),n=this.determinant();if(n<1e-14)throw"Matrix not invertible.";return e[0]=t[3]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[0]/n,e[4]=(t[2]*t[5]-t[3]*t[4])/n,e[5]=-(t[0]*t[5]-t[1]*t[4])/n,new s(e)},invert:function(){return this.multiply(this.inverse().elements)},identity:function(){return[1,0,0,1,0,0]},isIdentity:function(){var t=this.elements;return 1===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&0===t[4]&&0===t[5]},translate:function(t,e){return t instanceof i&&!e?this.multiply([1,0,0,1,t.x,t.y]):this.multiply([1,0,0,1,t,e])},scale:function(t,e){this.multiply([e,0,0,e,0,0]);var n=t.sub(t.scale(e)).scale(1/e);return this.translate(n)},rotateAboutPoint:function(t,e){var n=e*Math.PI/180;return this.multiply([Math.cos(n),Math.sin(n),-Math.sin(n),Math.cos(n),t.x-Math.cos(n)*t.x- -Math.sin(n)*t.y,t.y-Math.sin(n)*t.x-Math.cos(n)*t.y])},rotate:function(t,e){if(t instanceof i)return this.rotateAboutPoint(t,e);var n=t*Math.PI/180;return this.multiply([Math.cos(n),Math.sin(n),-Math.sin(n),Math.cos(n),0,0])},normaldegree:function(t){return t<0?t+360:t},rotation:function(t){var e=this.elements,n=180*Math.atan2(e[1],e[0])/Math.PI;return t?this.normaldegree(n):n},scaling:function(){return Math.sqrt(Math.pow(this.elements[0],2)+Math.pow(this.elements[1],2))},translation:function(){return new i(this.elements[4],this.elements[5])}};var l=s;function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,h(r.key),r)}}function h(t){var e=function(t,e){if("object"!=c(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==c(e)?e:e+""}var f=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.Items=[],this._add(e,e.element),this.Self=e,this._init()},e=[{key:"_getScroll",value:function(){return new i(window.pageXOffset||document.documentElement.scrollLeft,window.pageYOffset||document.documentElement.scrollTop)}},{key:"GetElementSize",value:function(t,e){e=e||getComputedStyle(t);var n=parseFloat(e.left),r=parseFloat(e.top),a=parseFloat(e.width),o=parseFloat(e.height);return{offset:new i(n||0,r||0),width:a,height:o,topleft:new i(0,0),topright:new i(a,0),bottomright:new i(a,o),bottomleft:new i(0,o)}}},{key:"_debug",value:function(){this.Items.forEach(function(t,e){console.log(t.matrix.elements)}),this.Items.forEach(function(t,e){console.log([t.element])})}},{key:"Refresh",value:function(){this.Items=[],this._add(this.Self,this.Self.element),this._init()}},{key:"_ispercent",value:function(t){return t.indexOf("%")>-1}},{key:"_isauto",value:function(t){return"auto"==t}},{key:"_pixelFromParent",value:function(t,e,n){if("0%"===e)return 0;var r=parseFloat(e);switch(t){case"left":r=parseFloat(n.width)*r/100;break;case"top":r=parseFloat(n.height)*r/100}return r}},{key:"GetComputedDims",value:function(t){var e,n,r,a=getComputedStyle(t),o=a.marginTop,i=a.marginLeft,s=a.left,l=a.top,c=this._ispercent(s),u=this._ispercent(l),h=function(t){return parseFloat(t)};return this._isauto(s)&&(s=0),this._isauto(l)&&(l=0),(c||u)&&(r=getComputedStyle(t.parentNode)),c&&(e=this._pixelFromParent("left",s,r)),u&&(n=this._pixelFromParent("top",l,r)),{left:void 0!==e?e:h(s),top:void 0!==n?n:h(l),marginLeft:h(i),marginTop:h(o),transform:a.transform}}},{key:"_init",value:function(){for(var t,e,n,r,a,o=this.Self.element;o.parentNode&&!o.parentNode.body;){var i=this.GetComputedDims(o.parentNode);t=i.transform,e=/matrix\(\-?[0-9]+[^\)]+\)/.test(t);var s=i.top,c=i.left,u=i.marginTop,h=i.marginLeft;if(e||o.parentNode.classList.contains("transformable")||o.classList.contains("transformable")||0!=s||0!=c||0!=u||0!=h)if(r=o.parentNode.getAttribute("data-transformable-id"))(n=Transformable.Instance[r])&&this._add(n);else{var f=!!e&&new l(this.Self._cssStringToArray(t));if(e||0!=s||0!=c||0!=u||0!=h||o.classList.contains("transformable")){(a=new l).translate(c||0,s||0).translate(h||0,u||0),f&&a.multiply(f.elements);var m=this.GetElementSize(o.parentNode);o.parentNode.style.top=0,o.parentNode.style.left=0,o.parentNode.style.marginLeft=0,o.parentNode.style.marginTop=0,o.parentNode.style.transformOrigin="0 0",o.parentNode.style.transform=this.Self._arrayToCssString(a.elements),this._add(a,o.parentNode,m)}}o=o.parentNode}}},{key:"_setoffset",value:function(){if(this.scroll=this._getScroll(),!this.offset){var t,e,n=new l;for(e=0;e<this.Items.length;e++)n.translate(this.Items[e].matrix.translation());for(e=0;e<this.Items.length;e++)if((t=this.Items[e]).element.classList.contains("transformable")){this.offset=t.transformable.offset.sub(n.translation());break}}}},{key:"_add",value:function(t,e){t instanceof Transformable&&this.Items.unshift({matrix:t.matrix,element:e||t.element,rect:t.sizes.element.initial,transformable:t}),t instanceof l&&this.Items.unshift({matrix:t,element:e,rect:this.GetElementSize(e)})}},{key:"GetParents",value:function(){var t=[];return this.Items.forEach(function(e,n){var r,a,o=e.transformable;o||(a=e.element.getAttribute("data-transformable-id"))&&(o=Transformable.Instance[a],e.transformable=o),r=o?o.matrix:e.matrix,t.push({Matrix:r,Inverse:r.inverse(),Element:e.element})}),t}},{key:"TransformCorners",value:function(t){var e=this.GetMatrix();return{bottomright:e.transformpoint(t.bottomright),bottomleft:e.transformpoint(t.bottomleft),topright:e.transformpoint(t.topright),topleft:e.transformpoint(t.topleft)}}},{key:"FirstParent",value:function(){var t=this.Items,e=t.length;return e>1&&t[e-2]}},{key:"GetMatrix",value:function(){var t=l.Identity();return this.Items.forEach(function(e,n){t.multiply(e.matrix.elements)}),t}},{key:"OffsetFromPoint",value:function(t,e){e=e||this.GetParents(),this._setoffset();for(var n,r=t,a=l.Identity().translate(this.offset),o=0;o<e.length;o++)n=e[o],a.multiply(n.Matrix.elements);return r=a.inverse().transformpoint(r)}}],e&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,s=[],l=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){c=!0,a=t}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw a}}return s}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return v(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,x(r.key),r)}}function b(t,e,n){return(e=x(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function x(t){var e=function(t,e){if("object"!=m(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==m(e)?e:e+""}!function(t,e){var n,r="";t.addEventListener?n="addEventListener":(n="attachEvent",r="on");var a="onwheel"in e.createElement("div")?"wheel":void 0!==e.onmousewheel?"mousewheel":"DOMMouseScroll";t.addWheelListener=function(e,o,i){var s=function(e,o,i,s){e[n](r+o,"wheel"===a?i:function(e){var n=e||t.event,r={originalEvent:n,target:n.target||n.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===n.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){n.preventDefault?n.preventDefault():n.returnValue=!1},stopPropagation:function(){n.stopPropagation?n.stopPropagation():n.returnValue=!1}};return"mousewheel"===a?(r.deltaY=-1/40*n.wheelDelta,n.wheelDeltaX&&(r.deltaX=-1/40*n.wheelDeltaX)):r.deltaY=n.detail,i(r)},s||!1)};s(e,a,o,i),"DOMMouseScroll"===a&&s(e,"MozMousePixelScroll",o,i)}}(window,document);var w,k,_=function(){function t(e){var n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e.length?e[0]:e,this.options=a,this.element.classList.add("transformable"),this.parent=this.element.parentNode,this.setInitialSizes(),a.matrix){var o,i,s={x:1,y:1};if(null!==(o=a.computedsize)&&void 0!==o&&o.width||null!==(i=a.computedsize)&&void 0!==i&&i.Width){var c={width:a.computedsize.width||a.computedsize.Width,height:a.computedsize.height||a.computedsize.Height},u=this.sizes.element.initial;s.x=u.width/c.width,s.y=u.height/c.height}Array.isArray(a.matrix)&&6===a.matrix.length?(a.matrix[4]*=s.x,a.matrix[5]*=s.y,this._setMatrix(new l(a.matrix))):a.matrix instanceof l&&(a.matrix.elements[4]*=s.x,a.matrix.elements[5]*=s.y,this._setMatrix(a.matrix))}(this.matrix=this._getMatrix(),this.originalTransition=this._getOriginalTransition(),this.Ancestry=new f(this),this._setOffset(),this.Ancestry._setoffset(),this.dragging=!1,this.start=null,this.orig=null,this.zooma=.001,this.events={start:a.start,move:a.move,stop:a.stop,tap:a.tap,transition:a.transition},this.element.setAttribute("data-transformable-id",t.Instance.push(this)-1),navigator.userAgent.includes("Edge")||this.element.setAttribute("draggable","false"),null!==(n=a.attachevents)&&void 0!==n&&!n||!1===a.editable)||(this._addEvents(),a.resize&&this.createResizeHandles(a.resize),null!==(r=a.disable)&&void 0!==r&&r.rotate||this.createRotateHandles(),a.handle&&"rotator-box"===a.type&&this._addRotateEvents(a.handle))}return e=t,n=[{key:"_getOriginalTransition",value:function(){var t=getComputedStyle(this.element).transition;return t?t.split(",").filter(function(t){return!t.trim().startsWith("transform")}).join(","):""}},{key:"tag",value:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild}},{key:"createRotateHandles",value:function(e){var n=this;if(!e||"rotate"===e){var r=this.tag('<div class="transformable-rotation-box"></div>'),a=this.tag('<svg class="transformable-svg-rotator" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 96 96" style="enable-background:new 0 0 96 96;" xml:space="preserve"><g><circle style="fill:#00A8DF;" cx="48.3" cy="48" r="35.3"/><g><path style="fill:#FFFFFF;" d="M35.2,3.8l4.1,28.5c0.2,1.5,2,2.1,3,1l8.2-8.2c0.7-0.7,1.8-0.7,2.5,0l8.8,8.8c7.8,7.8,9.1,20.2,1.2,28.2l-10,10c-0.7,0.7-1.8,0.7-2.5,0L41,62.6c-1-1-2.8-0.4-3,1l-4.1,28.5c-0.2,1.2,0.8,2.2,2,2l28.5-4.1c1.5-0.2,2.1-2,1-3l-8.9-8.9c-0.7-0.7-0.7-1.8,0-2.5l10-10c9.8-9.8,8.5-25.6-1.2-35.2l-8.8-8.8c-0.7-0.7-0.7-1.8,0-2.5L66.7,8.9c1-1,0.4-2.8-1-3L37.2,1.8C36,1.6,35,2.6,35.2,3.8z"/><g style="opacity:0.5;"><path d="M36.9,1.8c0.1,0,0.2,0,0.3,0l28.5,4.1c1.5,0.2,2.1,2,1,3L56.6,19.1c-0.7,0.7-0.7,1.8,0,2.5l8.8,8.8c9.7,9.7,11,25.5,1.2,35.2l-10,10c-0.7,0.7-0.7,1.8,0,2.5l8.9,8.9c1,1,0.4,2.8-1,3l-28.5,4.1c-0.1,0-0.2,0-0.3,0c-1.1,0-1.9-1-1.8-2.1l4.1-28.5c0.1-1,0.9-1.5,1.8-1.5c0.4,0,0.9,0.2,1.3,0.5l9.5,9.5c0.4,0.4,0.8,0.5,1.3,0.5s0.9-0.2,1.3-0.5l10-10c8-8,6.7-20.3-1.2-28.2L53,25.2c-0.4-0.4-0.8-0.5-1.3-0.5s-0.9,0.2-1.3,0.5l-8.2,8.2c-0.4,0.4-0.8,0.5-1.3,0.5c-0.8,0-1.7-0.6-1.8-1.5L35.2,3.8C35,2.7,35.9,1.8,36.9,1.8 M36.9-0.2c-1.1,0-2.1,0.5-2.9,1.3c-0.7,0.8-1,1.9-0.9,3l4.1,28.5c0.3,1.9,1.9,3.3,3.8,3.3c1,0,2-0.4,2.7-1.1l8.1-8.1l8.7,8.7c7.4,7.4,8,18.6,1.2,25.3l-9.8,9.8l-9.3-9.3c-0.7-0.7-1.7-1.1-2.7-1.1c-1.9,0-3.5,1.4-3.8,3.3l-4.1,28.5c-0.2,1.1,0.2,2.2,0.9,3c0.7,0.8,1.8,1.3,2.9,1.3c0.2,0,0.4,0,0.5,0l28.5-4.1c1.4-0.2,2.6-1.2,3.1-2.6c0.5-1.4,0.1-2.9-0.9-3.9l-8.7-8.7l9.8-9.8c10.2-10.2,9.6-27.2-1.2-38.1l-8.7-8.7l10-10c1-1,1.4-2.5,0.9-3.9c-0.5-1.4-1.6-2.4-3.1-2.6L37.5-0.2C37.3-0.2,37.1-0.2,36.9-0.2L36.9-0.2z"/></g></g></g></svg>'),o=this.tag('<svg class="transformable-svg-anchor" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 96 96" style="enable-background:new 0 0 96 96;" xml:space="preserve"><g><circle style="fill:#00A8DF;" cx="47.6" cy="48.4" r="17.6"/><g><path style="fill:#FFFFFF;" d="M69,46H50V27.2c0-1.4-1.1-2.4-2.5-2.4S45,25.9,45,27.2V46H26.6c-1.4,0-2.4,1.1-2.4,2.5s1.1,2.5,2.4,2.5H45v18.6c0,1.4,1.1,2.4,2.5,2.4s2.5-1.1,2.5-2.4V51h19c1.4,0,2.4-1.1,2.4-2.5S70.3,46,69,46z"/><g style="opacity:0.5;"><path d="M47.5,24.8c1.4,0,2.5,1.1,2.5,2.4V46h19c1.4,0,2.4,1.1,2.4,2.5c0,1.4-1.1,2.5-2.4,2.5H50v18.6c0,1.4-1.1,2.4-2.5,2.4S45,70.9,45,69.6V51H26.6c-1.4,0-2.4-1.1-2.4-2.5c0-1.4,1.1-2.5,2.4-2.5H45V27.2C45,25.9,46.1,24.8,47.5,24.8 M47.5,22.8c-2.5,0-4.5,2-4.5,4.4V44H26.6c-2.5,0-4.4,2-4.4,4.5c0,2.5,2,4.5,4.4,4.5H43v16.6c0,2.5,2,4.4,4.5,4.4s4.5-2,4.5-4.4V53h17c2.5,0,4.4-2,4.4-4.5c0-2.5-2-4.5-4.4-4.5H52V27.2C52,24.8,50,22.8,47.5,22.8L47.5,22.8z"/></g></g></g></svg>'),i=this.tag('<div class="transformable-rotation-line"></div>');r.append(i,o,a,this.tag('<div class="transformable-anchor-point"></div>')),"IMG"===this.element.nodeName?this.parent.appendChild(r):this.element.appendChild(r),r.addEventListener("click",function(t){return t.stopPropagation(),!1}),this.rotatorBox=new t(r,{type:"rotator-box",rotatetarget:this,handle:a,disable:{zoom:!0,rotate:!0,resize:!0}});var s=function(){var t;null!==(t=n.rotatorBox)&&void 0!==t&&t.parent&&n.rotatorBox.parent.classList.remove("transformable-mousedown"),n.off(document.body,"mouseup.rotatormouse")},l=function(t){t.stopPropagation&&t.stopPropagation(),n._resizeTimer&&clearTimeout(n._resizeTimer),n.rotatorBox.parent.classList.add("transformable-over","transformable-resize-over"),n.Ancestry.Items.forEach(function(t){t._overTimer&&clearTimeout(t._overTimer)}),n._overTimer=setTimeout(function(){var t=n.rotatorBox;parseFloat(getComputedStyle(t.element).width)>=32&&t.parent.classList.add("transformable-over-active");var e=n.Ancestry.Items.length;n.Ancestry.Items.forEach(function(t,n){n<e-2&&t.element.classList.remove("transformable-over-active")})},"number"==typeof t?t:1500)},c=this.rotatorBox.parent;this.on(c,"mouseenter.rotatormouse",l),this.on(c,"mouseleave.rotatormouse",function(t){n._overTimer&&clearTimeout(n._overTimer),n._resizeTimer=setTimeout(function(){n.element.classList.remove("transformable-resize-over")},500),t.currentTarget.classList.remove("transformable-over-active","transformable-over")}),this.on(c,"mousedown.rotatormouse",function(){n.rotatorBox.parent.classList.add("transformable-mousedown"),n.on(document.body,"mouseup.rotatormouse",s)}),this.on(c,"click.rotatormouse",function(){return l.call(c,0)})}}},{key:"createResizeHandles",value:function(t){if("tl-br"===t){var e=this.tag('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-271 394.9 52 52" style="enable-background:new -271 394.9 52 52;" xml:space="preserve"><g><path style="fill:#00A8DF;" d="M-244.9,421L-244.9,421L-244.9,421L-244.9,421L-244.9,421l26,0.1c0-10.8-6.1-20-16-24.1 c-10-4.1-20.8-2-28.4,5.7c-7.6,7.6-9.7,18.5-5.6,28.4c4.2,10,13.4,16,24.2,15.9L-244.9,421z"/><path style="fill:none;stroke:#FFFFFF;stroke-width:3;" d="M-251.6,414.3"/><path style="fill:none;stroke:#FFFFFF;stroke-width:3;" d="M-236.6,414.3"/></g><g><path style="fill:#FFFFFF;" d="M-227,419.5l-7.6-4.4c-1.1-0.6-2.4,0.2-2.4,1.4v1.9h-5.6v-5.5h2c1.2,0,2-1.3,1.4-2.4l-4.4-7.6 c-0.6-1.1-2.1-1.1-2.7,0l-4.4,7.6c-0.6,1.1,0.2,2.4,1.4,2.4h2v5.5h-5.6v-1.9c0-1.2-1.3-2-2.4-1.4l-7.6,4.4c-1.1,0.6-1.1,2.1,0,2.7 l7.6,4.4c1.1,0.6,2.4-0.2,2.4-1.4v-2h5.6v5.6h-2c-1.2,0-2,1.3-1.4,2.4l4.4,7.6c0.6,1.1,2.1,1.1,2.7,0l4.4-7.6 c0.6-1.1-0.2-2.4-1.4-2.4h-2v-5.6h5.6v2c0,1.2,1.3,2,2.4,1.4l7.6-4.4C-225.9,421.7-225.9,420.1-227,419.5z"/><path style="opacity:0.5;fill:#231F20;" d="M-245,402.1c0.5,0,1.1,0.3,1.4,0.8l4.4,7.6c0.6,1.1-0.2,2.4-1.4,2.4h-2v5.5h5.6v-1.9 c0-0.9,0.8-1.6,1.6-1.6c0.3,0,0.5,0.1,0.8,0.2l7.6,4.4c1.1,0.6,1.1,2.1,0,2.7l-7.6,4.4c-0.3,0.1-0.5,0.2-0.8,0.2 c-0.8,0-1.6-0.7-1.6-1.6v-2h-5.6v5.6h2c1.2,0,2,1.3,1.4,2.4l-4.4,7.6c-0.3,0.5-0.8,0.8-1.4,0.8c-0.5,0-1.1-0.3-1.4-0.8l-4.4-7.6 c-0.6-1.1,0.2-2.4,1.4-2.4h2v-5.6h-5.6v2c0,0.9-0.8,1.6-1.6,1.6c-0.3,0-0.5-0.1-0.8-0.2l-7.6-4.4c-1.1-0.6-1.1-2.1,0-2.7l7.6-4.4 c0.3-0.1,0.5-0.2,0.8-0.2c0.8,0,1.6,0.7,1.6,1.6v1.9h5.6v-5.5h-2c-1.2,0-2-1.3-1.4-2.4l4.4-7.6C-246.1,402.3-245.5,402.1-245,402.1 M-245,400.6c-1.1,0-2.1,0.6-2.6,1.5l-4.4,7.6c-0.5,0.9-0.5,2.1,0,3c0.5,0.9,1.5,1.5,2.6,1.5h0.5v2.7h-2.7v-0.5c0-1.7-1.4-3-3-3 c-0.5,0-1,0.1-1.5,0.4l-7.6,4.4c-0.9,0.5-1.5,1.5-1.5,2.6c0,1.1,0.6,2.1,1.5,2.6l7.6,4.4c0.5,0.3,1,0.4,1.5,0.4c1.7,0,3-1.4,3-3\tv-0.6h2.7v2.8h-0.5c-1.1,0-2.1,0.6-2.6,1.5c-0.5,0.9-0.5,2.1,0,3l4.4,7.6c0.5,0.9,1.5,1.5,2.6,1.5c1.1,0,2.1-0.6,2.6-1.5l4.4-7.6 c0.5-0.9,0.5-2.1,0-3c-0.5-0.9-1.5-1.5-2.6-1.5h-0.5v-2.8h2.7v0.6c0,1.7,1.4,3,3,3c0.5,0,1-0.1,1.5-0.4l7.6-4.4\tc0.9-0.5,1.5-1.5,1.5-2.6c0-1.1-0.6-2.1-1.5-2.6l-7.6-4.4c-0.5-0.3-1-0.4-1.5-0.4c-1.7,0-3,1.4-3,3v0.5h-2.7v-2.7h0.5\tc1.1,0,2.1-0.6,2.6-1.5c0.5-0.9,0.5-2.1,0-3l-4.4-7.6C-242.9,401.2-243.9,400.6-245,400.6L-245,400.6z"/></g></svg>'),n=this.tag('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-271 394.9 52 52" style="enable-background:new -271 394.9 52 52;" xml:space="preserve"><g><path style="fill:#00A8DF;" d="M-245,420.9L-245,420.9L-245,420.9L-245,420.9L-245,420.9l-26-0.1c0,10.8,6.1,20,16,24.1 c10,4.1,20.8,2,28.4-5.7c7.6-7.6,9.7-18.5,5.6-28.4c-4.2-10-13.4-16-24.2-15.9L-245,420.9z"/></g><g><path style="fill:#FFFFFF;" d="M-245.8,423l-2.5-2.5l-2.1,2.1c-0.9,0.9-2.3,0.5-2.6-0.7l-1.6-9.2c-0.3-1.2,0.8-2.3,1.9-1.9l9.2,1.6 c1.2,0.3,1.6,1.8,0.7,2.6l-2.1,2.1l2.5,2.5l2.7,2.7l-1-1l2.1-2.1c0.9-0.9,2.3-0.5,2.6,0.7l1.6,9.2c0.3,1.2-0.8,2.3-1.9,1.9 l-9.2-1.6c-1.2-0.3-1.6-1.8-0.7-2.6l2.1-2.1l-3.2-3.2L-245.8,423z"/><path style="opacity:0.5;fill:#231F20;" d="M-239.6,422.3l-1-1l2.1-2.1c0.7-0.7,1.7-0.6,2.2,0c0.2,0.2,0.3,0.4,0.4,0.7l1.6,9.2 c0.3,1.2-0.8,2.3-1.9,1.9l-9.2-1.6c-0.3-0.1-0.5-0.2-0.7-0.4c-0.6-0.6-0.7-1.6,0-2.2l2.1-2.1l-3.2-3.2l1.5,1.5l-2.5-2.5l-2.1,2.1 c-0.7,0.7-1.7,0.6-2.2,0c-0.2-0.2-0.3-0.4-0.4-0.7l-1.6-9.2c-0.3-1.2,0.8-2.3,1.9-1.9l9.2,1.6c0.3,0.1,0.5,0.2,0.7,0.4 c0.6,0.6,0.7,1.6,0,2.2l-2.1,2.1l2.5,2.5L-239.6,422.3z M-242.3,417.5l-0.5-0.5l1-1c1.2-1.2,1.2-3.1,0-4.3 c-0.4-0.4-0.8-0.6-1.4-0.8l-9.2-1.6c-1.1-0.3-2.1,0-2.9,0.8c-0.8,0.8-1.1,1.9-0.8,2.9l1.6,9.2c0.1,0.5,0.4,1,0.8,1.4 c1.2,1.2,3.1,1.2,4.3,0l1.1-1.1l0.5,0.5l0.5,0.5l1.2,1.2l-1.1,1.1c-1.2,1.2-1.2,3.1,0,4.3c0.4,0.4,0.8,0.6,1.4,0.8l9.2,1.6 c1.1,0.3,2.1,0,2.9-0.8c0.8-0.8,1.1-1.9,0.8-2.9l-1.6-9.2c-0.1-0.5-0.4-1-0.8-1.4c-1.2-1.2-3.1-1.2-4.3,0l-1,1l-1.2-1.2"/></g></svg>'),r=this.tag('<div class="transformable-resize-button"></div>'),a=r.cloneNode();r.classList.add("tl"),r.appendChild(e),a.classList.add("br"),a.appendChild(n),this.resizertl=r,this.resizerbr=a,this.element.appendChild(r),this.element.appendChild(a),this._addResizeEvents(r,a)}}},{key:"zoom",value:function(t){var e=this.Ancestry.OffsetFromPoint(this._findCentreInWindow());return this.scale(e,1+.05*t),this}},{key:"scale",value:function(t,e){return this.matrix.scale(t,e),this.setTransition(!0),this._updateElement(),this}},{key:"translate",value:function(t,e,n){return this.matrix.translate(t,e),this.setTransition(n),this._updateElement(),this}},{key:"rotate",value:function(t,e,n,r){var a=t;return a instanceof i&&a||(a=this.Ancestry.OffsetFromPoint(this._findCentreInWindow())),a instanceof i&&r&&(a=this.Ancestry.OffsetFromPoint(a)),this.matrix.rotate(a,e),this.lastrotationpoint=a,void 0!==n&&!1!==n||this.setTransition(!1),this._updateElement(),this}},{key:"straighten",value:function(){var t=this.matrix.rotation();return this.rotate(new i(this.sizes.element.initial.width/2,this.sizes.element.initial.height/2),-t,!0),this}},{key:"fittoparent",value:function(){var t=new i(this.sizes.element.initial.width,this.sizes.element.initial.height),e=this.Ancestry,n=e.GetParents(),r=e.FirstParent().rect,a=this.matrix.inverse(),o=a.transformpoint(r.topleft),s=a.transformpoint(r.topright),l=a.transformpoint(r.bottomleft),c=new i(this._distanceBetweenPoints(o,s),this._distanceBetweenPoints(o,l)).divide(t),u=Math.min(c.x,c.y);return this.scale(new i(0,0),u),this.centreinparent(!0,n),this.straighten(),this}},{key:"filltoparent",value:function(){var t=new i(this.sizes.element.initial.width,this.sizes.element.initial.height),e=this.Ancestry,n=e.GetParents(),r=e.FirstParent().rect,a=this.matrix.inverse(),o=a.transformpoint(r.topleft),s=a.transformpoint(r.topright),l=a.transformpoint(r.bottomleft),c=new i(this._distanceBetweenPoints(o,s),this._distanceBetweenPoints(o,l)).divide(t),u=Math.max(c.x,c.y);return this.scale(new i(0,0),u),this.centreinparent(!0,n),this.straighten(),this}},{key:"_getRect",value:function(t){return t.getBoundingClientRect()}},{key:"reset",value:function(t){var e,n,r=this;return this.InitialMatrix?this.matrix.elements=p(this.InitialMatrix):this.matrix.reset(),this.setTransition(null==t||t),this.transition&&(null!==(e=this.delta)&&void 0!==e&&e.x||null!==(n=this.delta)&&void 0!==n&&n.y)&&(this.element.classList.add("transformable-reset"),this.on(this.element,"transitionend.reset",function(){r.element.classList.remove("transformable-reset"),r.off(r.element,"transitionend.reset")})),this._updateElement(),this}},{key:"hasHistoryKey",value:function(t){return Array.isArray(this.matrix.history.undo[t])}},{key:"undo",value:function(t){return this.matrix.undo(t),this.setTransition(!0),this._updateElement(),this}},{key:"redo",value:function(){return this.matrix.redo(),this.setTransition(!0),this._updateElement(),this}},{key:"setInitialSizes",value:function(){if(!this.sizes){var t=window.getComputedStyle(this.element),e=parseFloat(t.width),n=parseFloat(t.height),r=parseFloat(t.left),a=parseFloat(t.top);this.sizes={element:{initial:{offset:new i(r,a),width:e,height:n,topleft:new i(0,0),topright:new i(e,0),bottomright:new i(e,n),bottomleft:new i(0,n)}},window:{width:parseFloat(getComputedStyle(document.body.parentNode).width)}}}}},{key:"_getOffset",value:function(t){var e=this._getRect(t),n=this.Ancestry._getScroll(),r=getComputedStyle(t),a=new i(parseFloat(r.left),parseFloat(r.top)),o=new i(e.left+n.x,e.top+n.y);return{offset:o,topleft:o,bottomright:new i(e.right,e.bottom),topright:new i(e.right,e.top),bottomleft:new i(e.left,e.bottom),pos:a}}},{key:"_setOffset",value:function(){if(!this.offset){var t=this._getOffset(this.element,!0);this.offset=t.offset,this.initialoffset=t.offset}}},{key:"_cssStringToArray",value:function(t){var e=t.match(/[0-9e., -]+/);return e?e[0].split(", ").map(function(t){return parseFloat(t)}):[]}},{key:"_arrayToCssString",value:function(t){return"matrix(".concat(t.join(","),")")}},{key:"_getMatrix",value:function(t){var e,n=t||this.element,r=getComputedStyle(n),a=getComputedStyle(this.parent),o=r.transform,i=r.top,s=r.left,c=r.marginTop,u=r.marginLeft,h=r.borderTopWidth,f=r.borderLeftWidth,m=i.includes("%")?parseFloat(a.height)*parseFloat(i)/100:parseFloat(i),d=s.includes("%")?parseFloat(a.width)*parseFloat(s)/100:parseFloat(s),g=parseFloat(c),v=parseFloat(u),y=parseFloat(h),b=parseFloat(f);/matrix\(-?[0-9e., -]+\)/.test(o)&&(e=this._cssStringToArray(o),this.InitialMatrix||(this.InitialMatrix=p(e)));var x=new l(e||[1,0,0,1,0,0]);return(d||m||g||v||y||b)&&(x.translate(d||0,m||0),x.translate(v||0,g||0),x.translate(b||0,y||0),Object.assign(n.style,{marginTop:"0px",marginLeft:"0px",top:"0px",left:"0px"}),n.style.marginTop=-(y||0)+"px",n.style.marginLeft=-(y||0)+"px",this.matrix=x,this._updateElement(),this.InitialMatrix=p(x.elements)),x}},{key:"setTransition",value:function(t){if("boolean"==typeof t&&this.transition!==t){var e=this.originalTransition?this.originalTransition.split(","):[];t?e.push("transform 0.5s"):e.push("transform 0s"),this.element.style.transition=e.join(","),this.transition=t}}},{key:"_updateElement",value:function(){this.element.style.transform="matrix(".concat(this.matrix.elements.join(","),")")}},{key:"_pushhistory",value:function(){this.matrix.save()}},{key:"_setMatrix",value:function(t){this.matrix=t,this._updateElement()}},{key:"_getPageXY",value:function(t,e){var n,r,a,o;return e?2===e.length?(n=this._getMiddle(e),r=this._getRotation(e),a=new i(e[0].pageX,e[0].pageY),o=new i(e[1].pageX,e[1].pageY)):(n=new i(e[0].pageX,e[0].pageY),r=this.matrix.rotation()):(n=new i(t.pageX,t.pageY),r=this.matrix.rotation()),{point:n,angle:r,p1:a,p2:o}}},{key:"_getPoint2",value:function(t,e){var n=this._getPageXY(t,e),r=this.Ancestry,a=r.GetParents(),o=r.OffsetFromPoint(n.point,a),s=n.p1&&n.p2?this._distanceBetweenPoints(r.OffsetFromPoint(n.p1,a),r.OffsetFromPoint(n.p2,a)):0,l=null;return void 0!==t.deltaX&&(l=new i(t.deltaX,t.deltaY)),{offset:o,pageXY:n.point,pageX:n.point.x,pageY:n.point.y,angle:n.angle,distance:s,deltaXY:l}}},{key:"_distanceBetweenPoints",value:function(t,e){var n=t.pageX?{x:"pageX",y:"pageY"}:{x:"x",y:"y"};return Math.sqrt(Math.pow(Math.abs(e[n.x]-t[n.x]),2)+Math.pow(Math.abs(e[n.y]-t[n.y]),2))}},{key:"_getMiddle",value:function(t){var e=d(t,2),n=e[0],r=e[1],a=(r.pageX-n.pageX)/2+n.pageX,o=(r.pageY-n.pageY)/2+n.pageY;return new i(a,o)}},{key:"_getDistance2",value:function(t,e){var n=this.Ancestry,r=e||n.GetParents(),a=n.OffsetFromPoint(new i(t[0].pageX,t[0].pageY),r),o=n.OffsetFromPoint(new i(t[1].pageX,t[1].pageY),r);return this._distanceBetweenPoints(a,o)}},{key:"_getRotation",value:function(t,e){var n=180*Math.atan2((t[0].pageY||t[0].y)-(t[1].pageY||t[1].y),(t[0].pageX||t[0].x)-(t[1].pageX||t[1].x))/Math.PI;return e?this.matrix.normaldegree(n):n}},{key:"snapRotation",value:function(){var t;if(null===(t=this.options.disable)||void 0===t||!t.rotate){var e,n=this.matrix.rotation(),r=n-15*Math.round(n/15),a=Math.abs(r),o=this.sizes.element.initial;if(this.setTransition(!0),a<=3&&a>0){var s=this.lastrotationpoint||new i(o.width/2,o.height/2);this.rotate(s,-r),this.lastlastrotationpoint=void 0,this._pushhistory()}switch(n=this.matrix.rotation(),Math.abs(Math.round(10*n)/10)){case 0:case 180:e="Horizontal";break;case 90:e="Vertical";break;default:e="Rotation: ".concat(Math.round(10*n)/10,"&deg;")}this.showMessage(e,"sticky",2e3)}}},{key:"showMessage",value:function(t,e,n){console.log(t)}},{key:"_findCentreInWindow",value:function(){var t=this._getRect(this.parent);return new i(t.left+t.width/2,t.top+t.height/2)}},{key:"centreinparent",value:function(t,e){var n=this.transition;this.setTransition(t),e||this.Ancestry.GetParents();var r=getComputedStyle(this.parent),a=new i(parseFloat(r.width)/2,parseFloat(r.height)/2),o=this.matrix.inverse().transformpoint(a);this.translate(o.sub(new i(this.sizes.element.initial.width/2,this.sizes.element.initial.height/2))),this.setTransition(n)}},{key:"pointInRectangle",value:function(t,e,n,r,a){var o=n.sub(e),i=t.sub(e),s=r.sub(n),l=t.sub(n),c=o.dot(i),u=o.dot(o),h=s.dot(l),f=s.dot(s);return{dot_abap:c,dot_abab:u,dot_bcbp:h,dot_bcbc:f,ok:0<=c&&Math.round(10*c)/10<=Math.round(10*u)/10&&0<=h&&Math.round(10*h)/10<=Math.round(10*f)/10}}},{key:"trigger",value:function(t,e){"function"==typeof this.events[t]&&this.events[t].call(this,this.element,e)}},{key:"_getRotatorPoints",value:function(t,e){var n=this.Ancestry,r=e||n.GetParents();n._setoffset();var a=t.touches,o=a?new i(a[0].pageX,a[0].pageY):new i(t.pageX,t.pageY),s=this.anchor.TL,l=Math.round(100*this._getRotation([s.add(n.scroll),o],!1))/100;return{deltaXY:null,offset:n.OffsetFromPoint(o,r),pageXY:o,pageX:o.x,pageY:o.y,angle:l,distance:0}}},{key:"_addRotateEvents",value:function(e){var n=this,r=function(e){var r;if(n.startedrotate&&(n.draggingrotate=!0,e.preventDefault(),e.stopPropagation(),2!==(null===(r=e.touches)||void 0===r?void 0:r.length))){var a=n._getRotatorPoints(e),o={angle:Math.round(100*(a.angle-n.startrotate.angle))/100};0!==o.angle&&(n.parent!==n.options.rotatetarget.element&&(n.matrix.rotateAboutPoint(new i(0),o.angle),n._updateElement()),n.options.rotatetarget instanceof t&&n.options.rotatetarget.rotate(n.anchor.TL.add(n.Ancestry.scroll),o.angle,!1,!0)),n.startrotate.angle=a.angle}},a=function(e){e.preventDefault(),e.stopPropagation(),n.element.classList.remove("transformable-active"),n.startedrotate=!1,n.draggingrotate=!1,n.off(document.body,"mouseup.transformable dragend.transformable"),n.options.rotatetarget instanceof t&&(n.options.rotatetarget.events.stop&&n.options.rotatetarget.trigger("stop",e),n.options.rotatetarget.snapRotation()),n.events.stop&&n.trigger("stop",e),n.snapRotation()};this.on(e,"mousedown.transformable touchstart.transformable",function(t){if(!n.options.disabled&&!n.startedresize){0==document.querySelectorAll(".transformable-active").length&&n.element.classList.add("transformable-active");var e=n.matrix;n.origrotate={trans:new i(e.elements[4],e.elements[5]),angle:e.rotation(!0),scale:e.scaling()};var o=t.touches;if(2===(null==o?void 0:o.length)&&o[0].target&&o[1].target&&o[0].target!==o[1].target)return console.log("Two active elements not supported"),!1;n.anchor=n.anchor||{},n.anchor.clientRect=n._getRect(n.element.querySelector(".transformable-anchor-point")),n.anchor.TL=new i(n.anchor.clientRect.left,n.anchor.clientRect.top),n.startrotate=n._getRotatorPoints(t),n.startrotate.scale=n.origrotate.scale,n.startedrotate=!0,n.draggingrotate=!1,n.setTransition(!1),t.stopPropagation(),"mousedown"===t.type&&(n.on(document.body,"mousemove.transformable",r),n.on(document.body,"mouseup.transformable dragend.transformable",a))}}),this.on(e,"touchmove.transformable",r),this.on(e,"touchend.transformable",a)}},{key:"_addResizeEvents",value:function(t,e){var n=this,r=function(t){var e;document.querySelector(".transformable-active")||n.element.classList.add("transformable-active"),t.preventDefault(),t.stopPropagation();var r=n.matrix;n.origresize={trans:new i(r.elements[4],r.elements[5]),angle:r.rotation(),scale:r.scaling()},n.startresize=n._getPoint2(t,t.touches),n.startresize.scale=n.origresize.scale,n.startedresize=!0,n.draggingresize=!1;var s=getComputedStyle(n.element);n.h=parseFloat(s.height),n.w=parseFloat(s.width),n.contained=null===(e=n.contained)||void 0===e||e,n.trigger("startresize",t),n.setTransition(!1),"mousedown"===t.type&&(n.on(document.body,"mousemove.transformable",a),n.on(document.body,"mouseup.transformable dragend.transformable",o))},a=function(t){var e;if(n.element.classList.contains("transformable-active")&&n.startedresize&&(n.draggingresize=!0,t.preventDefault(),t.stopPropagation(),2!==(null===(e=t.touches)||void 0===e?void 0:e.length))){var r=n._getPoint2(t,t.touches),a=n.startresize,o={trans:r.offset.sub(n.startresize.offset),angle:Math.round(100*(r.angle-a.angle))/100,distance:0!=a.distance?Math.round(r.distance/((a.distance+r.distance)/2)*1e3)/1e3:0};if(o.trans.nonzero()){var s=getComputedStyle(n.element),l=parseFloat(s.height),c=parseFloat(s.width),u=n.w-c,h=n.h-l,f=c+o.trans.x+u,m=l+o.trans.y+h;n.element.style.width="".concat(f,"px"),n.element.style.height="".concat(m,"px"),n.sizes.element.initial.bottomright=new i(f,m),n.sizes.element.initial.topright.x=f,n.sizes.element.initial.bottomleft.y=m,n.sizes.element.initial.width=f,n.sizes.element.initial.height=m}n.startresize.angle=r.angle}},o=function(){n.off(document.body,"mousemove.transformable",a),n.off(document.body,"mouseup.transformable dragend.transformable",o),n.options.disabled||(n.element.classList.remove("transformable-active"),n.startedresize=!1,n.draggingresize=!1)};this.on(e,"mousedown.transformable",r),this.on(e,"touchstart.transformable",r),this.on(e,"touchmove.transformable",a),this.on(e,"touchend.transformable",o)}},{key:"getRotationQuadrant",value:function(t){var e=(null!=t?t:this.matrix.rotation())%360,n=e<0?e+360:e;return{Angle:n,Quad:Math.floor(n/90),Horiz:0===n||180===n,Vert:90===n||270===n}}},{key:"_addEvents",value:function(){var t,e=this;"function"==typeof this.events.transition&&this.element.addEventListener("transitionend",this.events.transition);var n=function(t){if(!(e.options.disabled||e.startedresize||e.startedrotate)){if(document.querySelector(".transformable-active")||e.element.classList.add("transformable-active"),"rotator-box"===e.options.type){var n=t.target.closest("svg");if(n&&!n.classList.contains("transformable-svg-anchor"))return!1;t.stopPropagation()}var o=t.touches;e.start=e._getPoint2(t,o);var s=e.sizes.window;if(e.start.pageX<40||e.start.pageX>s.width-40)return console.log("edge cancel."),!1;if(e.delta={x:0,y:0},2===(null==o?void 0:o.length)&&o[0].target&&o[1].target&&o[0].target!==o[1].target)return console.log("Two active elements not supported"),!1;var l=e.matrix;e.orig={trans:new i(l.elements[4],l.elements[5]),angle:l.rotation(),scale:l.scaling()},e.start.scale=e.orig.scale,e.started=!0,e.dragging=!1,e.events.start&&e.trigger("start",t),e.setTransition(!1),"mousedown"===t.type&&(e.on(document.body,"mousemove.transformable",r),e.on(document.body,"mouseup.transformable dragend.transformable",a))}},r=function(t){if(e.options.disabled||!e.element.classList.contains("transformable-active")||!e.started||e.startedresize||e.startedrotate)return!1;e.dragging=!0,t.preventDefault(),t.stopPropagation();var n=t.touches,r=!1;if(2==(null==n?void 0:n.touches.length)&&n[0].target&&n[1].target&&n[0].target!==n[1].target)return console.log("Two active elements not supported"),!1;var a=e.matrix,o=e.options.disable,s=e.options&&e.options.contain,l=(null==o?void 0:o.zoom)||(null==o?void 0:o.scale),c=null==o?void 0:o.rotate,u=null==o?void 0:o.translate,h=e._getPoint2(t,n),f=(e.orig,e.start),m={trans:h.offset.sub(f.offset),angle:Math.round(100*(h.angle-f.angle))/100,distance:0!==f.distance?Math.round(h.distance/((f.distance+h.distance)/2)*1e3)/1e3:0},d=e;if(s&&0==m.angle&&(!n||n&&1==n.length)){var p,g,v,y,b=d.Ancestry.FirstParent().rect,x=a.inverse(),w=b.topleft,k=b.topright,_=b.bottomright,L=b.bottomleft;p=x.transformpoint(w).sub(m.trans),g=x.transformpoint(k).sub(m.trans),v=x.transformpoint(_).sub(m.trans),y=x.transformpoint(L).sub(m.trans),f.size?f.size=0!=m.distance?new i(d._distanceBetweenPoints(p,g),d._distanceBetweenPoints(p,y)):f.size:f.size=new i(d._distanceBetweenPoints(p,g),d._distanceBetweenPoints(p,y));var M=d.sizes.element.initial;if(d.options,"enclose"==s){var z=0;if((R={tl:d.pointInRectangle(M.topleft,p,g,v,y),tr:d.pointInRectangle(M.topright,p,g,v,y),br:d.pointInRectangle(M.bottomright,p,g,v,y),bl:d.pointInRectangle(M.bottomleft,p,g,v,y)}).tl.ok&&z++,R.tr.ok&&z++,R.br.ok&&z++,R.bl.ok&&z++,4!=z)switch((C=d.getRotationQuadrant(f.angle)).Quad){case 0:if(0==C.Angle){if(!R.br.ok){var F=M.bottomright.perpOnLine(g,v).sub(M.bottomright),P=M.bottomright.perpOnLine(y,v).sub(M.bottomright);F.x<0&&(m.trans=m.trans.add(F)),P.y<0&&(m.trans=m.trans.add(P))}if(!R.tl.ok){var S=M.topleft.perpOnLine(p,y),T=M.topleft.perpOnLine(p,g);S.x>0&&(m.trans=m.trans.add(S)),T.y>0&&(m.trans=m.trans.add(T))}}else{if(!R.bl.ok){var O=M.bottomleft.perpOnLine(p,y).sub(M.bottomleft);O.x>0&&(m.trans=m.trans.add(O))}if(R.br.ok||(P=M.bottomright.perpOnLine(y,v).sub(M.bottomright)).y<0&&(m.trans=m.trans.add(P)),!R.tr.ok){var A=M.topright.perpOnLine(g,v).sub(M.topright);A.x<0&&(m.trans=m.trans.add(A))}R.tl.ok||(T=M.topleft.perpOnLine(p,g)).y>0&&(m.trans=m.trans.add(T))}break;case 3:270==C.Angle?(R.tl.ok||(T=M.topleft.perpOnLine(p,y),(S=M.topleft.perpOnLine(y,v)).x>0&&(m.trans=m.trans.add(S)),T.y>0&&(m.trans=m.trans.add(T))),R.br.ok||(F=M.bottomright.perpOnLine(p,g).sub(M.bottomright),P=M.bottomright.perpOnLine(v,g).sub(M.bottomright),F.x<0&&(m.trans=m.trans.add(F)),P.y<0&&(m.trans=m.trans.add(P)))):(R.tl.ok||(S=M.topleft.perpOnLine(p,y)).x>0&&(m.trans=m.trans.add(S)),R.br.ok||(F=M.bottomright.perpOnLine(g,v).sub(M.bottomright)).x<0&&(m.trans=m.trans.add(F)),R.tr.ok||(I=M.topright.perpOnLine(p,g).sub(M.topright)).y>0&&(m.trans=m.trans.add(I)),R.bl.ok||(E=M.bottomleft.perpOnLine(y,v).sub(M.bottomleft)).y<0&&(m.trans=m.trans.add(E)));break;case 1:90==C.Angle?(R.tl.ok||(S=M.topleft.perpOnLine(g,p),T=M.topleft.perpOnLine(g,v),S.x>0&&(m.trans=m.trans.add(S)),T.y>0&&(m.trans=m.trans.add(T))),R.br.ok||(F=M.bottomright.perpOnLine(v,y).sub(M.bottomright),P=M.bottomright.perpOnLine(p,y).sub(M.bottomright),F.x<0&&(m.trans=m.trans.add(F)),P.y<0&&(m.trans=m.trans.add(P)))):(R.tl.ok||(S=M.topleft.perpOnLine(g,v)).x>0&&(m.trans=m.trans.add(S)),R.br.ok||(F=M.bottomright.perpOnLine(p,y).sub(M.bottomright)).x<0&&(m.trans=m.trans.add(F)),R.tr.ok||(I=M.topright.perpOnLine(y,v).sub(M.topright)).y>0&&(m.trans=m.trans.add(I)),R.bl.ok||(E=M.bottomleft.perpOnLine(g,p).sub(M.bottomleft)).y<0&&(m.trans=m.trans.add(E)));break;case 2:var I,E;180==C.Angle&&(R.tl.ok||(S=M.topleft.perpOnLine(v,y),T=M.topleft.perpOnLine(p,y),S.y>0&&(m.trans=m.trans.add(S)),T.y>0&&(m.trans=m.trans.add(T))),R.br.ok||(F=M.bottomright.perpOnLine(g,p).sub(M.bottomright),P=M.bottomright.perpOnLine(g,v).sub(M.bottomright),F.y<0&&(m.trans=m.trans.add(F)),P.y<0&&(m.trans=m.trans.add(P)))),R.tl.ok||(S=M.topleft.perpOnLine(v,y)).y>0&&(m.trans=m.trans.add(S)),R.br.ok||(F=M.bottomright.perpOnLine(g,p).sub(M.bottomright)).y<0&&(m.trans=m.trans.add(F)),R.tr.ok||(I=M.topright.perpOnLine(p,y).sub(M.topright)).x<0&&(m.trans=m.trans.add(I)),R.bl.ok||(E=M.bottomleft.perpOnLine(g,v).sub(M.bottomleft)).x>0&&(m.trans=m.trans.add(E))}}if("cover"==s){var R,C,X=0;if((R={tl:d.pointInRectangle(M.topleft,p,g,v,y),tr:d.pointInRectangle(M.topright,p,g,v,y),br:d.pointInRectangle(M.bottomright,p,g,v,y),bl:d.pointInRectangle(M.bottomleft,p,g,v,y)}).tl.ok||X++,R.tr.ok||X++,R.br.ok||X++,R.bl.ok||X++,!R.tl.ok&&!R.tr.ok&&!R.br.ok&&!R.bl.ok||d.lockcontain||3==X&&0==f.angle)switch(d.lockcontain=!0,(C=d.getRotationQuadrant(f.angle)).Quad){case 0:g.y<=0&&(m.trans.y=m.trans.y+g.y),y.y>=M.bottomleft.y&&(m.trans.y=m.trans.y+(y.y-M.bottomleft.y)),v.x>=M.bottomright.x&&(m.trans.x=m.trans.x+(v.x-M.bottomright.x)),p.x<=0&&(m.trans.x=m.trans.x+p.x);break;case 1:p.y>=M.bottomleft.y&&(m.trans.y=m.trans.y+(p.y-M.bottomleft.y)),y.x>=M.topright.x&&(m.trans.x=m.trans.x-(M.topright.x-y.x)),v.y<=0&&(m.trans.y=m.trans.y+v.y),g.x<=0&&(m.trans.x=m.trans.x+g.x);break;case 2:y.y<=0&&(m.trans.y=m.trans.y+y.y),p.x>=M.bottomright.x&&(m.trans.x=m.trans.x-(M.bottomright.x-p.x)),g.y>=M.bottomleft.y&&(m.trans.y=m.trans.y+(g.y-M.bottomleft.y)),v.x<=0&&(m.trans.x=m.trans.x+v.x);break;case 3:p.y<=0&&(m.trans.y=m.trans.y+p.y),y.x<=0&&(m.trans.x=m.trans.x+y.x),v.y>=M.bottomright.y&&(m.trans.y=m.trans.y+(v.y-M.bottomright.y)),g.x>=M.topright.x&&(m.trans.x=m.trans.x-(M.topright.x-g.x))}}}return m.trans.nonzero()&&!u&&(a.translate(m.trans),r=!0,d.delta.x+=m.trans.x,d.delta.y+=m.trans.y),0!=m.distance&&1!=m.distance&&n&&(2!=n.length||l||(a.scale(h.offset,m.distance),r=!0)),0==m.angle||c||(a.rotateAboutPoint(h.offset,m.angle),r=!0),r&&d._updateElement(a),d.start.angle=h.angle,d.events.move&&d.trigger("move",t),!1},a=function(t){if(e.off(document.body,"mousemove.transformable",r),e.off(document.body,"mouseup.transformable dragend.transformable",a),e.element.classList.remove("transformable-active","transformable-reset"),e.options.disabled)return!1;e.lockcontain=!1,e.started&&e.dragging&&(e._pushhistory(),e.snapRotation()),e.started&&!e.dragging&&e.trigger("tap",t),e.dragging=!1,e.started=!1,e.events.stop&&e.trigger("stop",t),e.setTransition(!0);var n=e,o=n.rotatorBox,s=n.resizertl,l=n.resizerbr;if(o){var c=n.matrix.scaling();o.scale(new i(0),1/o.matrix.scaling()*(1/c))}if(s&&l){var u=c||n.matrix.scaling();s.style.transform="scale("+1/u+")",l.style.transform="scale("+1/u+")"}};this.on(this.element,"mousedown.transformable",n),this.on(this.element,"touchstart.transformable",n),this.on(this.element,"touchmove.transformable",r),this.on(this.element,"touchend.transformable",a),this.on(this.element,"scroll.transformable",function(t){return console.log("tried scroll"),t.preventDefault(),t.stopPropagation(),!1}),(!this.options.disable||null!==(t=this.options.disable)&&void 0!==t&&t.wheel)&&(navigator.userAgent.includes("Mac OS")||addWheelListener(this.element,function(t){if(e.options.disabled||e.startedresize||e.startedrotate||"rotator-box"===e.options.type)return!1;t.preventDefault(),t.stopPropagation();var n=Date.now();if((e.lastwheelmove?n-e.lastwheelmove:150)<150&&navigator.userAgent.includes("Mac"))return!1;document.querySelector(".transformable-active")||e.element.classList.add("transformable-active"),e.rotatorBox&&e.rotatorBox.parent.classList.add("transformable-wheel-active"),e._wheelTimer&&clearTimeout(e._wheelTimer);var r=e._getPoint2(t),a=e.matrix;if(e.setTransition(!0),0!==r.deltaXY.y){var o=1+.05*(r.deltaXY.y<0?1:-1);a.scale(r.offset,o),e._updateElement()}e.element.classList.remove("transformable-active"),e._wheelTimer=setTimeout(function(){e._pushhistory(),e.rotatorBox&&e.rotatorBox.parent.classList.remove("transformable-wheel-active")},750),e.lastwheelmove=n}))}},{key:"on",value:function(e,n,r,a){var o,i,s,l,c,u=n.split(" ");for(o=0;o<u.length;o++)s=(i=u[o].split("."))[0],l=i.length>1&&i[1],e.addEventListener(s,r,a||!1),t.Handlers.Namespaces[n]||(t.Handlers.Namespaces[n]=[]),l&&(t.Handlers.Namespaces[l]||(t.Handlers.Namespaces[l]=[])),c=t.Handlers.Namespaces[n].push({event:s,func:r,opts:a||!1}),l&&t.Handlers.Namespaces[l].push(t.Handlers.Namespaces[n][c-1])}},{key:"off",value:function(e,n,r){var a=t.Handlers.Namespaces[n];if(a){var o,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=g(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}(a);try{for(i.s();!(o=i.n()).done;){var s=o.value;e.removeEventListener(s.event,s.func,s.opts||!1)}}catch(t){i.e(t)}finally{i.f()}}}},{key:"Refresh",value:function(){this.sizes=void 0,this.setInitialSizes(),this.Ancestry.Refresh()}}],n&&y(e.prototype,n),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();b(_,"Instance",[]),b(_,"Handlers",{Namespaces:{}}),k=function(){document.querySelectorAll(".transformable").forEach(function(t){var e=t.getAttribute("data-transformable-id"),n=e?_.Instance[e]:null;n instanceof _&&n.Refresh()})},window.addEventListener("resize",function(){clearTimeout(w),w=setTimeout(k,150)}),"undefined"!=typeof window&&(window.Transformable=_);var L=_;return e=e.default}()});